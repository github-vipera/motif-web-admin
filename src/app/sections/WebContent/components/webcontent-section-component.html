<wc-loading-overlay [visible]="loading"></wc-loading-overlay>
<wa-webcontent-update-dialog #updateDialog></wa-webcontent-update-dialog>

<wc-dashboard-header [title]="'Web Content'"></wc-dashboard-header>

<div class="row spread">
  <div class="flex-toolbar" style="display:flex;align-items: center;">
    <div>
      <label>&nbsp;</label>
      <kendo-buttongroup look="flat">
        <button
          kendoButton
          [toggleable]="false"
          (click)="onUploadBundleClicked($event)"
        >
          <fa-icon [icon]="faUpload"></fa-icon>Add Bundle
        </button>
      </kendo-buttongroup>
    </div>
  </div>

  <div class="flex-cmd">
    <kendo-buttongroup look="flat">
      <button
        kendoButton
        [toggleable]="false"
        [icon]="'refresh'"
        (click)="onRefreshClicked()"
      >
        Refresh
      </button>
    </kendo-buttongroup>
  </div>
</div>

<div class="row fill">

  <div>

    <wc-slide-panel #uploadSlideDownPanel>
        <div class="wc-slide-down-editor-pane" style="display:flex;height: 45px;">
            <div style="width:350px;height: 100%;">
                    <wc-file-drop-panel #fileDrop></wc-file-drop-panel>
            </div>
        </div>

        <div class="cmd" style="align-items: center;">
            <label style="padding-bottom: 0px;padding-left: 10px;padding-right: 10px;">Do Upload?</label>
            <a (click)="onBundleUploadConfirm()">
                <svg class="ok" data-id="ok">
                    <use xlink:href="assets/img/icons.svg#ico-ok"></use>
                </svg>
            </a>
            <a (click)="onBundleUploadCancel()" data-slideup="#user-add">
                <svg class="ko" data-id="ko">
                    <use xlink:href="assets/img/icons.svg#ico-ko"></use>
                </svg>
            </a>
        </div>
    </wc-slide-panel>

    <kendo-grid #datagrid [data]="gridData">
      <kendo-grid-column field="info.name" title="Name"> </kendo-grid-column>

      <kendo-grid-column field="info.version" title="Version">
      </kendo-grid-column>

      <kendo-grid-column field="info.context" title="Context">
      </kendo-grid-column>

      <kendo-grid-column field="info.syntheticStatus" title="Status">
        <ng-template
          kendoGridCellTemplate
          let-dataItem
          let-columnIndex="columnIndex"
          let-rowIndex="rowIndex"
          let-column="column"
        >
          <wc-grid-editor-command
            [rowIndex]="rowIndex"
            [hasConfirmation]="true"
            [confirmationTitleProvider]="publishConfirmationTitleProvider"
            [columnIndex]="columnIndex"
            [column]="column"
            [value]="dataItem[column.field]"
            [dataItem]="dataItem"
            (commandConfirm)="doTogglePublishBundle(dataItem)"
          >
            <span
              *ngIf="dataItem.info.syntheticStatus === 'PUBLISHED'"
              class="badge badge-status badge-enabled"
            >
              PUBLISHED
            </span>
            <span
              *ngIf="dataItem.info.syntheticStatus === 'UNPUBLISHED'"
              class="badge badge-status  badge-disabled"
            >
              UNPUBLISHED
            </span>
            <span
              *ngIf="dataItem.info.syntheticStatus === 'IN ERROR'"
              class="badge badge-status  badge-error"
            >
              IN ERROR
            </span>
          </wc-grid-editor-command>
        </ng-template>
      </kendo-grid-column>

      <kendo-grid-column title="">
        <ng-template
          kendoGridCellTemplate
          let-dataItem
          let-columnIndex="columnIndex"
          let-rowIndex="rowIndex"
          let-column="column"
        >
          <wc-grid-editor-commands-group
            [commands]="commands"
            [alignMode]="'end'"
            [rowIndex]="rowIndex"
            [columnIndex]="columnIndex"
            [column]="column"
            [value]="dataItem[column.field]"
            [dataItem]="dataItem"
            (commandConfirm)="onCommandConfirm($event)"
            (commandClick)="onCommandClick($event)"
          ></wc-grid-editor-commands-group>
        </ng-template>
      </kendo-grid-column>

      <div *kendoGridDetailTemplate="let dataItem">
        <kendo-grid #datagridDetails [data]="dataItem.status">
          <kendo-grid-column field="instance" title="Node"> </kendo-grid-column>
          <kendo-grid-column field="status" title="Status">
            <ng-template
              kendoGridCellTemplate
              let-dataItem
              let-columnIndex="columnIndex"
              let-rowIndex="rowIndex"
              let-column="column"
            >
              <span
                *ngIf="dataItem.status === 'PUBLISHED'"
                class="badge badge-status badge-enabled"
              >
                PUBLISHED
              </span>
              <span
                *ngIf="dataItem.status === 'UNPUBLISHED'"
                class="badge badge-status  badge-disabled"
              >
                UNPUBLISHED
              </span>
            </ng-template>
          </kendo-grid-column>
        </kendo-grid>
      </div>
    </kendo-grid>

  </div>

</div>
